
// const BASE_URL = "https://latest.currency-api.pages.dev/v1/currencies" ;
// const BASE_URL2 ="https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@/latest/currencies";


/*
    <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter</title>

    <link rel="icon" href="./images/money-bag.png">

    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body>

    <header>
        <h1 id="heading">Currency ðŸ’± Converter</h1>
    </header><br>

    <div class="container">
        <form action="">
            <div class="amount">
                <p>Enter Amount</p>
                <input type="text" value="1" name="" id="">
            </div>

            <div class="dropdown">
                <div class="from">
                    <p>From</p>
                    <div class="select-container">
                        <img src="https://flagsapi.com/US/flat/64.png" alt="flag">
                        <select name="from" id="">
                            

                        </select>
                    </div>
                </div>

                <i class="fa-solid fa-arrow-right-arrow-left"></i>

                <div class="to">
                    <p>To</p>
                    <div class="select-container">
                        <img src="https://flagsapi.com/IN/flat/64.png" alt="flag">
                        <select name="to" id="">
                           

                        </select>
                    </div>
                </div>
            </div>

            <div class="msg">1USD = 80INR</div>
            <button id="btn">Get Exchange Rate</button>

        </form>
    </div>

    <script src="codes (1).js"></script>
    <script src="app.js"></script>
</body>

</html>
*/ 

const dropdowns = document.querySelectorAll('.dropdown select') ;
const btn = document.getElementById('btn') ;

const fromCurr = document.querySelector('.from select')  ;
const toCurr = document.querySelector('.to select') ;

const msg = document.querySelector('.msg') ;



for (let select of dropdowns){
    for (currCode in countryList) {
        let newOption = document.createElement("option") ;
        newOption.innerText = currCode ;
        newOption.value = currCode ;

        if(select.name === 'from' && currCode === 'USD'){
            newOption.selected = 'selected' ;
        }
        else if(select.name === 'to' && currCode === 'INR'){
            newOption.selected = 'selected' ;   
        }

         select.append(newOption) ;
    }

    select.addEventListener("change", (evt)=>{
        updateFlag(evt.target) ; 
    })
}

const updateFlag = (element) => {
    let currCode = element.value ;
    let countryCode = countryList[currCode] ;

    
    
    let newSrc = `https://flagsapi.com/${countryCode}/flat/64.png` ;

    let flag =  element.parentElement.querySelector('img') ;
    flag.src = newSrc ;
}



const process = async (evt)=>{

    if(evt){
        evt.preventDefault() ;

    }
    let amount = document.querySelector('.amount input') ;
    let amtVal = amount.value ;
    
    if(amtVal === '' || amtVal<0) {
        amtVal = 0 ;
        amount.value = 0 ;
    }
    console.log(amtVal) ;

   // console.log(fromCurr.value, toCurr.value) ;
   const URL = `${BASE_URL}/${fromCurr.value.toLowerCase()}.json` ;

   let response = await fetch(URL) ;   //returns a promise
   let data = await response.json() ;  // promise to js object

   let rate = data[fromCurr.value.toLowerCase()][toCurr.value.toLowerCase()] ;
    
    let finalAmoount = amtVal * rate ;
    console.log(finalAmoount) ; 

    msg.innerText = `${amtVal} ${fromCurr.value} = ${finalAmoount} ${toCurr.value}`
}

btn.addEventListener("click", process) ;

process(null) ;
